// Generated by CoffeeScript 1.6.3
(function() {
  angular.module('test', []).directive('dynamicTemplate', function($compile) {
    return {
      restrict: 'E',
      scope: {
        template: '&'
      },
      compile: function(elem, attrs) {
        return function(scope, element, attrs) {
          var bye_watch, cur, remove;
          cur = void 0;
          remove = void 0;
          bye_watch = scope.$watch(function() {
            var new_scope, template;
            template = scope.template();
            if (template === cur) {
              return;
            }
            cur = template;
            if (typeof remove === "function") {
              remove();
            }
            element.html(template);
            new_scope = scope.$new();
            remove = function() {
              return new_scope.$destroy();
            };
            return $compile(element.contents())(new_scope);
          });
          return scope.$on('$destroy', function() {
            bye_watch();
            return typeof remove === "function" ? remove() : void 0;
          });
        };
      }
    };
  }).controller('MainCtrl', function($scope) {
    $scope.index = 1;
    $scope.templates = {
      1: '<div ng-controller="X"><div>changed -> 1 {{value}}</div><button class="btn btn-primary">Test</button></div>',
      2: '<div ng-controller="Y">NUMBER 2 - changed -> 2 {{value}}</div>',
      3: '<div>pending</div>'
    };
    return $scope.sel = function(x) {
      return $scope.index = x;
    };
  }).controller('X', function($scope) {
    $scope.value = 'this is X';
    return $scope.$on('$destroy', function() {
      return console.log('X was properly destroyed');
    });
  }).controller('Y', function($scope) {
    $scope.value = 'this is Y';
    return $scope.$on('$destroy', function() {
      return console.log('Y was properly destroyed');
    });
  });

}).call(this);
